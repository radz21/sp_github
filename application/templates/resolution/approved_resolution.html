<div class="col-sm-12">
    <div class="card">
        <div class="card-header d-flex justify-content-between">
           <div class="header-title">
                <h4 class="card-title">APPROVED RESOLUTION</h4>
           </div>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table id="tbl_resolution" class="table table-striped" data-toggle="data-table" width="98.8%">
                    <colgroup>
                        <col style="width: 3px;">
                        <col style="width: 20px;">
                        <col style="width: 4px;">
                        <col style="width: 3px;">
                        <col style="width: 3px;">
                    </colgroup>
                    <thead >
                        <th>Reso No.</th>
                        <th>Title</th>
                        <th>Date Enacted</th>
                        <th>Remarks</th>
                        <th>Action</th>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
       </div>
    </div>
</div>
<script type="text/javascript">
    $(document).ready(function(){
        $( "#approved_resolution" ).addClass( "active" );
        $( "#resolution-menu" ).addClass( "show" );
        load_resolution()
    })

function load_resolution() {
    if ($.fn.DataTable.isDataTable("#tbl_resolution")) {
        $("#tbl_resolution").DataTable().destroy();
    }

    $.fn.dataTable.ext.type.order['resolution-number-pre'] = function (data) {
        var match = data.match(/R(\d+)-(\d+)/);
        if (match) {
            return (parseInt(match[1]) * 1000000) + parseInt(match[2]);
        }
        return 0;
    };

    var table = $('#tbl_resolution').DataTable({
        responsive: true,
        searching: true,
        bStateSave: true,
        "ajax": {
            "type": "POST",
            "url": '/get_resolution',
            contentType: 'application/JSON',
            "data": function () {
                return JSON.stringify({ status: 6 });
            },
            "dataSrc": function (data) {
                data.forEach(function (item) {
                    var open_doc = `<button type='button' class="btn btn-sm btn-icon text-primary flex-end" onclick="open_doc_res(this, '#tbl_resolution')">
                        <span class="btn-inner">
                            <svg width="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M11.4925 2.78906H7.75349C4.67849 2.78906 2.75049 4.96606 2.75049 8.04806V16.3621C2.75049 19.4441 4.66949 21.6211 7.75349 21.6211H16.5775C19.6625 21.6211 21.5815 19.4441 21.5815 16.3621V12.3341" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                                <path fill-rule="evenodd" clip-rule="evenodd" d="M8.82812 10.921L16.3011 3.44799C17.2321 2.51799 18.7411 2.51799 19.6721 3.44799L20.8891 4.66499C21.8201 5.59599 21.8201 7.10599 20.8891 8.03599L13.3801 15.545C12.9731 15.952 12.4211 16.181 11.8451 16.181H8.09912L8.19312 12.401C8.20712 11.845 8.43412 11.315 8.82812 10.921Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                                <path d="M15.1655 4.60254L19.7315 9.16854" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                            </svg>
                        </span>
                    </button>`;
                    item.action = open_doc;
                });
                return data;
            }
        },
        dom: 'Bfrtip',
        columns: [
            { data: "resolution_number", type: "resolution-number" },
            { data: "resolution_title" },
            { data: "date_enacted" },
            { data: "remarks" },
            { data: "action" }
        ],
        columnDefs: [
            { responsivePriority: 1, targets: 0 },
            { targets: 0, type: 'ordinance-number-pre' }
        ],
        buttons: [
            {
                text: 'Add',
                action: function (e, dt, node, config) {
                    getbyId('form_resolution').reset();
                    getbyId('btn_resolution_committee').style.display = "none";
                    if ($.fn.DataTable.isDataTable('#tbl_res_attach_file')) {
                        $('#tbl_res_attach_file').DataTable().clear().draw();
                    }
                    if ($.fn.DataTable.isDataTable('#tbl_add_minutes_file_resolution')) {
                        $('#tbl_add_minutes_file_resolution').DataTable().clear().draw();
                    }
                    if ($.fn.DataTable.isDataTable('#tbl_veto_resolution')) {
                        $('#tbl_veto_resolution').DataTable().clear().draw();
                    }
                    getbyId('h_resolution_id').value = 0;
                    getbyId('h_legislature_res').value = "";
                    getbyId('h_committee_id_res').value = "";
                    getbyId('status_resolution').value = 6;
                    getbyId('div_resolution_author').innerHTML = "";
                    getbyId('div_resolution_co_author').innerHTML = "";
                    getbyId('div_resolution_sponsor').innerHTML = "";
                    $('#sel_ordinance_category_res').val('').trigger('chosen:updated');
                    $("#div_resolution_modal").modal('toggle');
                },
                className: 'btn btn-sm btn-primary'
            },
            {
                extend: 'print',
                text: 'Print',
                filename: 'file',
                title: 'Print',
                titleAttr: 'Print',
                className: 'btn btn-sm btn-warning'
            }
        ],
        "pagingType": "full_numbers",
        "pageLength": 5,
        "order": [[0, "desc"]] // Ensure descending order
    });

    // Remove the draw.dt event or adjust it:
    $('#tbl_resolution').off('draw.dt').on('draw.dt', function () {
        var table = $('#tbl_resolution').DataTable();
        if (table.order()[0][0] !== 0) {
            table.order([0, 'desc']).draw();
        }
    });

    // Function to clear other DataTables if needed
    function clearDataTable(tableId) {
        if ($.fn.DataTable.isDataTable(tableId)) {
            $(tableId).DataTable().clear().draw();
        }
    }
}
</script>